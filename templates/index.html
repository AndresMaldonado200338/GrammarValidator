<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grammar Validator</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center">Validación de Gramáticas</h1>
        <form id="grammarForm">
            <!-- Reglas de Producción (P) -->
            <div class="mb-3">
                <label for="P" class="form-label">Reglas de Producción (P)</label>
                <div id="productions">
                    <div class="production-group">
                        <input type="text" class="form-control mb-2" placeholder="Ej: S -> AB | B">
                        <span class="error-message text-danger"></span>
                    </div>
                </div>
                <button type="button" class="btn btn-secondary" onclick="addProduction()">+</button>
            </div>

            <button type="submit" class="btn btn-primary">Validar Gramática</button>
        </form>

        <div id="result" class="mt-4"></div>
    </div>

    <script>
        // Agregar más campos para reglas de producción
        function addProduction() {
            const div = document.createElement('div');
            div.classList.add('production-group');
            div.innerHTML = `
                <input type="text" class="form-control mb-2" placeholder="Ej: A -> aB | b">
                <span class="error-message text-danger"></span>
            `;
            document.getElementById('productions').appendChild(div);
        }

        // Validar el formulario antes de enviar
        function validateForm() {
            let isValid = true;

            document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

            const productionInputs = document.querySelectorAll('#productions input');
            const productionRegex = /^[A-Z]\s*->\s*[a-zA-Z]+(\s*\|\s*[a-zA-Z]+)*$/; // Formato: "A -> aB | b"

            productionInputs.forEach(input => {
                const rule = input.value.trim();
                const errorElement = input.nextElementSibling;

                if (!rule) {
                    errorElement.textContent = 'Este campo no puede estar vacío.';
                    isValid = false;
                } else if (!productionRegex.test(rule)) {
                    errorElement.textContent = `Regla no válida. Use el formato "A -> aB | b".`;
                    isValid = false;
                } else {
                    errorElement.textContent = '';
                }
            });

            return isValid;
        }

        // Envío del formulario
        document.getElementById('grammarForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        if (!validateForm()) return;

        const P = Array.from(document.querySelectorAll('#productions input')).map(input => input.value.trim());

        try {
            const response = await fetch('/validate_grammar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ P })
            });
            const result = await response.json();

            document.getElementById('result').innerHTML = `
                <p><strong>Resultados:</strong></p>
                <p><strong>No terminales N:</strong> {${[...result.no_terminales].join(', ')}}</p>
                <p><strong>Terminales T:</strong> {${[...result.terminales].join(', ')}}</p>
                <p><strong>Axioma inicial S:</strong> ${result.axioma}</p>
                <p><strong>La gramática</strong> ${result.tipo}</p>
            `;
        } catch (error) {
            document.getElementById('result').innerHTML = `<p class="text-danger">Error al validar la gramática.</p>`;
        }
    });

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>